#####
# mas-kt here !!!
server {
        listen   80;
        #server_name 0.mas-kt.misho.lan 1.mas-kt.misho.lan 2.mas-kt.misho.lan 3.mas-kt.misho.lan st.0.mas-kt.misho.lan;
	server_name 0.dev.mlinuxgada.info st.0.dev.mlinuxgada.info m.0.dev.mlinuxgada.info 1.dev.mlinuxgada.info st.1.dev.mlinuxgada.info m.1.dev.mlinuxgada.info 2.dev.mlinuxgada.info st.2.dev.mlinuxgada.info m.2.dev.mlinuxgada.info 3.dev.mlinuxgada.info st.3.dev.mlinuxgada.info m.3.dev.mlinuxgada.info 4.dev.mlinuxgada.info st.4.dev.mlinuxgada.info m.4.dev.mlinuxgada.info;
	#server_name dev.mlinuxgada.info st.dev.mlinuxgada.info m.dev.mlinuxgada.info;

        set $root_path '/storage_dev/projects/www/mas-kt/html';
        #set $root_path '/storage_dev/projects/www/mas/html';
        root $root_path;
        index index.php;
	
        location / {
                rewrite ^/divinity-cart/([^/]+)/([^/]+)/.*/([0123456789]+)-?(.*)\.html(?:\?(.*))?$ /index.php?page=$1&id=$2&p=$3&template=$4&seo=1&$5 last;
                rewrite ^/divinity-cart/([^/]+)/([^/]+)/1-?(.*)\.html(?:\?(.*))?$ /index.php?page=$1&id=$2&template=$3&seo=1&$4 last;
		if (!-f "$document_root$uri") {
			rewrite ^(.*)$ /index.php?$1&seo=1 last;
		}
        }
        location ~ \.php$ {
                include fastcgi_params;
                fastcgi_param SCRIPT_FILENAME $root_path/$fastcgi_script_name;
                fastcgi_param DOCUMENT_ROOT $root_path;
                if (-f $request_filename) {
                   fastcgi_pass php56-fpm;
                   #fastcgi_pass phpng-fpm;
                   #fastcgi_pass hhvm;
                }
        }

        location ~ \.hh$ {
                include fastcgi_params;
                fastcgi_param SCRIPT_FILENAME $root_path/$fastcgi_script_name;
                fastcgi_param DOCUMENT_ROOT $root_path;
                if (-f $request_filename) {
                   fastcgi_pass hhvm;
                }
        }

        # deny access to .htaccess files, if Apache's document root concurs with nginx's one
        #
        location ~ /\.ht {
                deny all;
        }
}


####
# mas-kt https here !!!
server {
        listen   443 ssl; ## listen for ipv4; this line is default and implied

        #server_name 0.mas-kt.misho.lan 1.mas-kt.misho.lan 2.mas-kt.misho.lan 3.mas-kt.misho.lan st.0.mas-kt.misho.lan;
	server_name 0.dev.mlinuxgada.info st.0.dev.mlinuxgada.info m.0.dev.mlinuxgada.info 1.dev.mlinuxgada.info st.1.dev.mlinuxgada.info m.1.dev.mlinuxgada.info 2.dev.mlinuxgada.info st.2.dev.mlinuxgada.info m.2.dev.mlinuxgada.info 3.dev.mlinuxgada.info st.3.dev.mlinuxgada.info m.3.dev.mlinuxgada.info 4.dev.mlinuxgada.info st.4.dev.mlinuxgada.info m.4.dev.mlinuxgada.info;
	#server_name dev.mlinuxgada.info st.dev.mlinuxgada.info m.dev.mlinuxgada.info;

        ssl                     on;
        ssl_certificate         /etc/nginx/my_key.crt;
        ssl_certificate_key     /etc/nginx/my_key.key;
        ssl_session_timeout     5m;

        set $root_path '/storage_dev/projects/www/mas-kt/html';
        #set $root_path '/storage_dev/projects/www/mas/html';
        
	root $root_path;
        index index.php;

        location / {
        rewrite ^/divinity-cart/([^/]+)/([^/]+)/.*/([0123456789]+)-?(.*)\.html(?:\?(.*))?$ /index.php?page=$1&id=$2&p=$3&template=$4&seo=1&$5 last;
        rewrite ^/divinity-cart/([^/]+)/([^/]+)/1-?(.*)\.html(?:\?(.*))?$ /index.php?page=$1&id=$2&template=$3&seo=1&$4 last;
        }
        location ~ \.php$ {
                include fastcgi_params;
                fastcgi_param HTTPS on;
                fastcgi_param SCRIPT_FILENAME $root_path/$fastcgi_script_name;
                fastcgi_param DOCUMENT_ROOT $root_path;
                if (-f $request_filename) {
                   fastcgi_pass php56-fpm;
		   #fastcgi_pass phpng-fpm;
                   #fastcgi_pass hhvm;
                }
        }

        location ~ \.hh$ {
                include fastcgi_params;
                fastcgi_param HTTPS on;
                fastcgi_param SCRIPT_FILENAME $root_path/$fastcgi_script_name;
                fastcgi_param DOCUMENT_ROOT $root_path;
                if (-f $request_filename) {
                   fastcgi_pass hhvm;
                }
        }

        # deny access to .htaccess files, if Apache's document root concurs with nginx's one
        #
        location ~ /\.ht {
                deny all;
        }
}

